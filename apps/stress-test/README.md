# @fluentui/stress-test

Stress Test is an application for testing Fluent UI components in "stressful" scenarios so we can evaluate performance.

This application is configured to support Fluent UI v8, v9 and Web Components.

Stress Test is a simple Webpack application as Webpack allows us to support Fluent v8, v9 and Web Components in a single app while using each version of Fluent natively (that is, the React versions of Fluent are typical React apps, the Web Component version is a typical web component app). Additionally, Griffel, a dependency of Fluent v9 provides some Webpack loaders so Stress Test needs to be able to use those.

## Glossary

- **scenario**: A testing scenario for a specific line of investigation. For example, if you wanted to compare the performance of different `Button` implementations you might create a "button-test" scenario for various targets.
- **targets**: Different implementation targets. For example: "v8" for Fluent UI v8, "v9" for Fluent UI v9, "wc" for Fluent UI Web Components.
- **test cases**: Different test cases to run against a given scenario. For example, you might want to test mounting performance for a scenario.

## Development

Use `yarn start` and select `@fluentui/stress-test` from the list of options to start the application in development mode.

### Project layout

The project is laid out with folders for each supported version of Fluent (`v8`, `v9`, `wc`) with subfolders in each folder representing a test case. In general there should be corresponding cases between all three versions of Fluent.

The `shared` folder is for utilities that are shared across Fluent versions.

The `components` folder is also split by supported Fluent versions and is where compoenents that can be shared across test cases live.

The `benchmarks` folder houses Tachometer configurations and test results; and helper scripts for generating configurations and processing results.

The `scripts` folder house the Stress Test CLI app that is used to run tests.

### Adding test cases

Currently, new test cases must be manually added. Add tests cases to the `pages` array in `webpack.config.js` and they will be generated by Webpack. This configuration keeps the different Fluent versions in separate Webpack chunks. The dev server needs to be restarted after changes to the config file.

## Production

**NOTE**: Tests should be run against production builds. While tests can be run against development builds, and this is useful for gathering quick results, the performance characteristics of development and production builds can differ quite a bit.

Building for production creates a static production application that can be served with a simple HTTP server.

Run `yarn workspace @fluentui/stress-test build:app` to build only this application. If you do not need to build dependencies like `@fluentui/react` this is much faster.

Run `yarn workspace @fluentui/stress-test build:local` to build all the dependencies for this application (e.g., `@fluentui/react`, `@fluentui/web-components`) along with the application. This is much slower but useful if this it the first time you're building the app or you've pulled in lots of changes.

## Using the CLI

The CLI is used to run tests and process the results of tests. The CLI handles creating configuration files to run tests, spins up an HTTP server and runs the actual tests. Each step can be handled individiually or you can use a convenience command to run everything for a test case.

Invoke the CLI with

    $ yarn workspace @fluentui/stress-test stress-test

This will show the help documentation which will provide the details for each command. What follows is a high level overview of the CLI's features.

### Commands

- `run`: Runs a test end-to-end. Creates configuration files, starts up an HTTP server, runs the tests, and processes the results.
- `build-test-config`: Generates test configuration files only.
- `process-results`: Processes the results of a test run.
- `serve`: Starts the HTTP server.
- `tachometer`: Runs Tachometers against an HTTP server based.

### Examples

    # Run the "simple-stress" scenario with the "mount" and "prop-update" test cases against Firefox with small sizes and low sample size
    $ yarn workspace @fluentui/stress-test stress-test run --scenario simple-stress --sample-size 2 --test-cases mount prop-update --browsers firefox --sizes xs s

    # Run the "simple-stress" scenario with the "mount" and "prop-update" test cases against the default browsers at the default sizes and sample size
    $ yarn workspace @fluentui/stress-test stress-test run --scenario simple-stress --test-cases mount prop-update
