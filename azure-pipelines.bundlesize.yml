pr:
  - 7.0

trigger:
  - 7.0

jobs:
  - job: build
    timeoutInMinutes: 75
    pool: '1ES-Host-Ubuntu'
    workspace:
      clean: all
    steps:
      - template: .devops/templates/tools.yml

      - task: Bash@3
        inputs:
          filePath: yarn-ci.sh
        displayName: yarn

      - script: yarn build --to test-bundles --no-cache
        displayName: yarn build to test-bundles

      - script: yarn workspace test-bundles bundle:size
        displayName: yarn bundle test-bundles

      - script: yarn bundlesizecollect
        displayName: 'Collate Bundle Size Information'

      - template: .devops/templates/cleanup.yml
