import { join, resolve } from 'node:path';
import baseConfig from '<%= relativePathToProjectRoot %>/cypress.config';

// Resolve dependencies from the shared react-version root folder (injected by CLI)
const usedNodeModulesPath = join(__dirname, '<%= usedNodeModulesDirRelative %>', 'node_modules');

const config = { ...baseConfig };

const specs = [resolve('<%= relativePathToProjectRoot %>/**/src/**/*.cy.{tsx,ts}')];

config.component.specPattern = specs;
config.component.devServer.webpackConfig.resolve ??= {};
config.component.devServer.webpackConfig.resolve.alias = {
  ...config.component.devServer.webpackConfig.resolve.alias,
  '@cypress/react': resolve(usedNodeModulesPath, './@cypress/react'),
  '@types/react': resolve(usedNodeModulesPath, './@types/react'),
  '@types/react-dom': resolve(usedNodeModulesPath, './@types/react-dom'),
  react: resolve(usedNodeModulesPath, './react'),
  'react-dom': resolve(usedNodeModulesPath, './react-dom'),
};

export default config;
