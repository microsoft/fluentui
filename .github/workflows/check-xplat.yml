name: Check Xplat
on:
  pull_request:
jobs:
  bundle-xplat:
    strategy:
      matrix:
        platform: [macos-14, windows-2022]
    runs-on: ${{ matrix.platform }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4.0.1
        with:
          # TODO: Temporarily downgrade until tooling correctly handles
          # the security fixes in 18.20.2
          node-version: '18.20.1'
          cache: yarn
      - name: Install npm dependencies
        run: yarn --frozen-lockfile --ignore-platform
      - name: Build dependencies
        run: yarn build --to xplat-v9
      - name: Bundle for Android
        run: yarn build:android
        working-directory: apps/xplat-v9
      - name: Bundle for iOS
        run: yarn build:ios
        working-directory: apps/xplat-v9
      - name: Bundle for macOS
        run: yarn build:macos
        working-directory: apps/xplat-v9
      - name: Bundle for Windows
        run: yarn build:windows
        working-directory: apps/xplat-v9
