# Install versions of Node and Yarn required by build pipelines.
steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '12.x'
    displayName: 'Install Node.js'

  - task: YarnInstaller@0
    displayName: 'Use Yarn 1.22.x'
    inputs:
      versionSpec: 1.22.x
      checkLatest: false
      includePrerelease: false

  # For multiline scripts, we want the whole task to fail if any line of the script fails.
  # ADO doesn't have bash configured this way by default. To fix we override the SHELLOPTS built-in variable.
  # https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html
  # The options below include ADO defaults (braceexpand:hashall:interactive-comments) plus
  # errexit:errtrace:nounset:xtrace for better logging and error behavior.
  - script: |
      echo "##vso[task.setvariable variable=shellopts]braceexpand:hashall:interactive-comments:errexit:errtrace:nounset:xtrace"
    displayName: Force exit on error (bash)
